{
    "componentChunkName": "component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx",
    "path": "/debugging-sip-connections-with-sngrep-on-linux",
    "result": {"data":{"post":{"slug":"/debugging-sip-connections-with-sngrep-on-linux","title":"Technical Notes: Debugging SIP Connections with sngrep on Linux","date":"01.03.2025","tags":[{"name":"AI","slug":"ai"},{"name":"VoIP","slug":"vo-ip"},{"name":"Linux","slug":"linux"},{"name":"Networking","slug":"networking"}],"description":null,"canonicalUrl":null,"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"slug\": \"debugging-sip-connections-with-sngrep-on-linux\",\n  \"title\": \"Technical Notes: Debugging SIP Connections with sngrep on Linux\",\n  \"date\": \"2025-03-01T00:00:00.000Z\",\n  \"tags\": [\"AI\", \"VoIP\", \"Linux\", \"Networking\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h3\", null, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Overview\")), mdx(\"p\", null, \"When leading the implementation and maintenance of SIP-based communication systems\\u2014such as Asterisk, LiveKit SIP Gateway, or FreeSWITCH\\u2014having full visibility into real-time signaling flows is critical. As a Technical Lead, I\\u2019ve found that being hands-on with tools like sngrep helps not only in debugging complex production issues quickly but also in guiding the team through clear, observable patterns.\"), mdx(\"p\", null, \"sngrep is my go-to terminal-based tool when I need to trace SIP INVITE flows, verify header correctness (From, Contact), or confirm how our infrastructure responds to authentication challenges and call failures.\"), mdx(\"p\", null, \"In this note, I\\u2019ll walk through how to install and use sngrep on Linux to diagnose outbound or inbound SIP call problems with clarity and precision.\"), mdx(\"hr\", null), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"42.5%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjElEQVQoz2WQW2vbQBCFZ/ai3dVepGQtC0uyGzu6WLWUBEIvNHVocRw3oZg2eSj0of//ZxQ5DX7o4WOYl+GcM3C62Se7Z3/3Q368s7ePJ5/u0802u//2Zv+n2f+ePfzKd0/Z7c7fbP32p/vynX/YvBC8/wpZnsdKeAIewBEMkaBkfmzaNH87rcYqEpwjAAGgAAhHDbuf14HW4CRMImIVJQSMis/y7ePD5/V61XeTLAuEEEoprZXWSAgcQEohXdRSKUVpzLlgjOFwLKejsirb5bIoCu+9McZaa6x1zulQIw6uw3TTc6l1ILm0SihBKeVSxf7UOSeEtMZY54w21tkwDAkhlNJ/sREhnS1UZGFkYOJo4pBR6+I8y+M4DkPFGKOUkoNeDI+dEUEX88BaNII4xbREQqITXzd131+MkkRI+fqdA3hkKD8uZoozDqABBEECELu4q8siTYzg8jXk/xpiRNfrsLmUdS+WF7LqedWZ7p2/viHzFuctXbSsXLGyG6g6dr6iZc+aK9Zc8ebyL18sJJ6g0U22AAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"alt text\",\n    \"title\": \"alt text\",\n    \"src\": \"/static/5649e7558f581866005d1426a8c0cb2c/7d769/sip_debug.png\",\n    \"srcSet\": [\"/static/5649e7558f581866005d1426a8c0cb2c/5243c/sip_debug.png 240w\", \"/static/5649e7558f581866005d1426a8c0cb2c/ab158/sip_debug.png 480w\", \"/static/5649e7558f581866005d1426a8c0cb2c/7d769/sip_debug.png 960w\", \"/static/5649e7558f581866005d1426a8c0cb2c/87339/sip_debug.png 1440w\", \"/static/5649e7558f581866005d1426a8c0cb2c/ba05f/sip_debug.png 1502w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"h3\", null, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Problem: SIP Call Is Failing or Audio Is Missing\")), mdx(\"p\", null, \"You might see:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The INVITE is sent, but there\\u2019s no audio (RTP path or NAT issue).\\n\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The SIP trunk rejects with 403/480/487 errors.\\n\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"From or Contact headers use local IPs instead of your public domain (e.g., cta.kt070.co.kr).\\n\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"No ACK or improper dialog termination.\\n\")), mdx(\"p\", null, \"Without proper tooling, debugging these scenarios becomes time-consuming and error-prone.\"), mdx(\"hr\", null), mdx(\"h3\", null, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Solution: Use sngrep to Trace SIP Calls\")), mdx(\"p\", null, \"sngrep is a lightweight, ncurses-based SIP flow analyzer. It captures SIP messages in real time and organizes them into clean call flow diagrams right in your terminal.\"), mdx(\"hr\", null), mdx(\"h3\", null, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Step 1: Install sngrep\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"sudo apt update && sudo apt install sngrep -y     # Debian/Ubuntu\\nsudo yum install sngrep -y                        # CentOS/RHEL\\n\")), mdx(\"hr\", null), mdx(\"h3\", null, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Step 2: Capture SIP Traffic\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"sudo sngrep\\n\")), mdx(\"p\", null, \"Or to narrow the capture:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"sudo sngrep -d any port 5060\\n\")), mdx(\"p\", null, \"Press:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Enter to inspect full SIP headers\\n\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"F7 to save a .pcap file\\n\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"q to quit\\n\")), mdx(\"hr\", null), mdx(\"h3\", null, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Step 3: Make a SIP Call and Observe\")), mdx(\"p\", null, \"Initiate a call through your SIP system (LiveKit, Asterisk, or a softphone like PhonerLite). As the call is made, sngrep will immediately begin to populate with real-time SIP dialog flows.\"), mdx(\"p\", null, \"In a typical successful outbound call, you\\u2019ll observe something like:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"INVITE -> 100 Trying -> 180 Ringing -> 200 OK -> ACK\\n\")), mdx(\"p\", null, \"Each arrow represents a SIP message being exchanged between your client and the SIP server (or provider gateway).\"), mdx(\"p\", null, \"In some cases, the first INVITE is not immediately accepted. Here\\u2019s a more complete flow involving SIP authentication:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"INVITE\\n   -> 407 Proxy Authentication Required\\nINVITE (with credentials: username + digest + nonce)\\n   -> 100 Trying\\n   -> 180 Ringing\\n   -> 200 OK\\nACK\\n\")), mdx(\"p\", null, \"This allows you to verify:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"From, To, and Contact headers\\n\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"SIP status codes (e.g., 401 Unauthorized, 403 Forbidden)\\n\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Call-ID and CSeq consistency\\n\")), mdx(\"hr\", null), mdx(\"h3\", null, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Step 4: Export and Analyze Further\")), mdx(\"p\", null, \"To save and analyze in Wireshark later:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"sudo sngrep -O /tmp/sip_capture.pcap\\nwireshark /tmp/sip_capture.pcap\\n\")), mdx(\"hr\", null), mdx(\"h3\", null, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Step 5: What to Look For\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Header validation\"), \": Ensure headers use correct domain (cta.kt070.co.kr) instead of private IP.\\n\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Status codes\"), \": 480, 403, and 487 reveal common call rejection reasons.\\n\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Missing ACK\"), \": Might indicate firewall or NAT traversal issue.\\n\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"No RTP despite 200 OK\"), \": Indicates signaling succeeded, but media path failed.\\n\")), mdx(\"hr\", null), mdx(\"h3\", null, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Lessons Learned\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"sngrep reveals SIP call state transitions faster than traditional logs.\\n\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Incorrect From/Contact headers can silently break interoperability with SIP providers.\\n\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Having the right tooling accessible lets you lead technical triage sessions with clarity.\\n\")), mdx(\"hr\", null), mdx(\"h3\", null, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Conclusion\")), mdx(\"p\", null, \"As a Technical Lead, being able to step in and debug SIP signaling directly from the terminal is empowering. sngrep makes that possible with minimal overhead. Whether you\\u2019re troubleshooting LiveKit SIP Gateway routing issues or verifying a trunk integration with KT, this tool saves you\\u2014and your team\\u2014valuable time and guesswork.\"), mdx(\"hr\", null), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"These are real-world experiences I\\u2019ve encountered while deploying and maintaining SIP infrastructure in production. I wrote this article with the help of my AI assistant to better organize and present the content clearly.\")), mdx(\"p\", null, \"I hope this guide helps other DevOps, VoIP engineers, or anyone who finds themselves deep in the weeds of SIP signaling debugging.\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Overview When leading the implementation and maintenance of SIP-based communication systems—such as Asterisk, LiveKit SIP Gateway, or…","timeToRead":2,"banner":null}},"pageContext":{"slug":"/debugging-sip-connections-with-sngrep-on-linux","formatString":"DD.MM.YYYY"}},
    "staticQueryHashes": ["2744905544","3090400250","318001574"]}