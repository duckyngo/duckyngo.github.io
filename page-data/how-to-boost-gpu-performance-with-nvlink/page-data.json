{
    "componentChunkName": "component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx",
    "path": "/how-to-boost-gpu-performance-with-nvlink",
    "result": {"data":{"post":{"slug":"/how-to-boost-gpu-performance-with-nvlink","title":"How to Boosting GPU Performance with NVLink","date":"01.06.2024","tags":[{"name":"AI","slug":"ai"}],"description":null,"canonicalUrl":null,"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"slug\": \"how-to-boost-gpu-performance-with-nvlink\",\n  \"title\": \"How to Boosting GPU Performance with NVLink\",\n  \"date\": \"2024-06-01T00:00:00.000Z\",\n  \"tags\": [\"AI\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"When training large machine learning models across multiple GPUs, the way your GPUs are connected can have a huge impact on your training speed. One of the key technologies that can help here is \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"NVLink\"), \", developed by NVIDIA.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"34.166666666666664%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABVklEQVQoz3WQ204cMQyG5zV7UVEqoSJxAaqQeCKkggBVHC54jDIsXc4wdNmFGRh255DESearkoVtucDSr8j2Z8d2st1bZL+/ytbxApvpVzbSL2ykc/w4+szPkyX2+t/Z/b3Mbn+F7d63mAvMZjoftdNb5OB0jfVfnzjND0m0nWBchbIvtFKi7JhGnsirc4rqEiVjalNQNn8om4xaF5Fp5SVKfI3tFNpNEKdI+MDEeFRrsOLwLvguytluxnQe2kbTtgqtTPSTs+uUs6uU4eMdXde9yqNUS91UiBistWito0QktIqcc5bh8J4syyiKHO89yVV2wsVtyuPTYPrra1MRi9GCsw7nHGJ1lHXybwsRiqJgNBrFN3DvVg6N3qxWJWU9oNHjCObPdwzzG1pdz9gwUZg+5INCLAlB7zs6PwXeJpxUY0YPA6p6Ev1wS2PsjJnW+f/ONI39BVk/DmdHGxnpAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"image\",\n    \"title\": \"image\",\n    \"src\": \"/static/9a53b79185e3840ec9f086bbe5e8047f/7d769/image.png\",\n    \"srcSet\": [\"/static/9a53b79185e3840ec9f086bbe5e8047f/5243c/image.png 240w\", \"/static/9a53b79185e3840ec9f086bbe5e8047f/ab158/image.png 480w\", \"/static/9a53b79185e3840ec9f086bbe5e8047f/7d769/image.png 960w\", \"/static/9a53b79185e3840ec9f086bbe5e8047f/87339/image.png 1440w\", \"/static/9a53b79185e3840ec9f086bbe5e8047f/c52b3/image.png 1917w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"h3\", null, \"What is NVLink?\"), mdx(\"p\", null, \"In simple terms, NVLink is a high-speed connection between GPUs. It\\u2019s much faster than the traditional PCIe connection, allowing GPUs to share data more quickly. Think of it as a superhighway for your data, compared to a regular road.\"), mdx(\"hr\", null), mdx(\"h3\", null, \"Why Does NVLink Matter?\"), mdx(\"p\", null, \"When GPUs need to exchange a lot of data during training, a faster connection helps them work more efficiently. For example:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"If two GPUs are connected via NVLink, they can transfer data up to \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"23% faster\"), \" compared to using PCIe alone.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"This speed boost is especially important for models that require frequent communication between GPUs.\")), mdx(\"hr\", null), mdx(\"h3\", null, \"Real Example: GPU Connectivity in Action\"), mdx(\"p\", null, \"You can check how your GPUs are connected by running:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"nvidia-smi topo -m\\n\")), mdx(\"p\", null, \"Here\\u2019s an example from my company\\u2019s setup:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"        GPU0    GPU1    GPU2    GPU3    CPU Affinity    NUMA Affinity\\nGPU0     X      NV4     SYS     SYS     0,2,4,6,8,10    0\\nGPU1    NV4      X      SYS     SYS     0,2,4,6,8,10    0\\nGPU2    SYS     SYS      X      NV4     1,3,5,7,9,11    1\\nGPU3    SYS     SYS     NV4      X      1,3,5,7,9,11    1\\n\\nLegend:\\n\\n  X    = Self\\n  SYS  = Connection traversing PCIe as well as the SMP interconnect between NUMA nodes (e.g., QPI/UPI)\\n  NODE = Connection traversing PCIe as well as the interconnect between PCIe Host Bridges within a NUMA node\\n  PHB  = Connection traversing PCIe as well as a PCIe Host Bridge (typically the CPU)\\n  PXB  = Connection traversing multiple PCIe bridges (without traversing the PCIe Host Bridge)\\n  PIX  = Connection traversing at most a single PCIe bridge\\n  NV#  = Connection traversing a bonded set of # NVLinks\\n\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"GPU0 and GPU1 are connected via NVLink (NV4)\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"GPU2 and GPU3 are also connected via NVLink (NV4)\"))), mdx(\"p\", null, \"Legend:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"NV#\"), \": Connection using NVLink (e.g., NV4 means 4 bonded NVLinks).\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"SYS\"), \": Connection using PCIe.\")), mdx(\"hr\", null), mdx(\"h3\", null, \"How Does NVLink Improve Training?\"), mdx(\"p\", null, \"Here\\u2019s a quick comparison of training a GPT-2 model with and without NVLink from \", \"[1]\", \":\"), mdx(\"table\", null, mdx(\"thead\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"thead\"\n  }, mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"NVLink\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Training Time\"))), mdx(\"tbody\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"strong\", {\n    parentName: \"td\"\n  }, \"Yes\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"101 seconds\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"strong\", {\n    parentName: \"td\"\n  }, \"No\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"131 seconds\")))), mdx(\"p\", null, \"This shows that NVLink speeds up training by \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"~23%\"), \".\"), mdx(\"hr\", null), mdx(\"h3\", null, \"When Is NVLink Most Useful?\"), mdx(\"p\", null, \"The benefit of NVLink depends on how often GPUs need to talk to each other:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Rare Communication (e.g., DDP)\"), \": The impact of NVLink is smaller because GPUs work more independently.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Frequent Communication (e.g., ZeRO-DP)\"), \": The impact is much larger because GPUs constantly share data.\")), mdx(\"hr\", null), mdx(\"h3\", null, \"Takeaway for Your GPU Setup\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Use GPUs with NVLink connections\"), \" when you need maximum speed for training models that frequently exchange data.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Check your system\\u2019s connectivity with \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"nvidia-smi topo -m\"), \" and plan your GPU usage accordingly. For example, in the setup above, GPU0 and GPU1 work best as a pair, and GPU2 and GPU3 work best as another pair.\")), mdx(\"p\", null, \" \", \"[1]\", \" Ref: \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://huggingface.co/transformers/v4.9.2/performance.html\"\n  }, \"https://huggingface.co/transformers/v4.9.2/performance.html\")));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"When training large machine learning models across multiple GPUs, the way your GPUs are connected can have a huge impact on your trainingâ€¦","timeToRead":1,"banner":null}},"pageContext":{"slug":"/how-to-boost-gpu-performance-with-nvlink","formatString":"DD.MM.YYYY"}},
    "staticQueryHashes": ["2744905544","3090400250","318001574"]}