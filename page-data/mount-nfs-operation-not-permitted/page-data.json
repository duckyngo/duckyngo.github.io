{
    "componentChunkName": "component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx",
    "path": "/mount-nfs-operation-not-permitted",
    "result": {"data":{"post":{"slug":"/mount-nfs-operation-not-permitted","title":"Technical Notes: Fixing `mount.nfs: Operation not permitted` in Proxmox LXC Container","date":"16.06.2024","tags":[{"name":"Homelab","slug":"homelab"},{"name":"Proxmox","slug":"proxmox"},{"name":"NFS","slug":"nfs"}],"description":null,"canonicalUrl":null,"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"slug\": \"mount-nfs-operation-not-permitted\",\n  \"title\": \"Technical Notes: Fixing `mount.nfs: Operation not permitted` in Proxmox LXC Container\",\n  \"date\": \"2024-06-16T00:00:00.000Z\",\n  \"tags\": [\"Homelab\", \"Proxmox\", \"NFS\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h3\", null, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Overview\")), mdx(\"p\", null, \"Recently while configuring a new Ubuntu 24.04 container inside Proxmox VE, I ran into a subtle but frustrating issue: NFS shares mounted perfectly inside a VM, but failed inside the container with this cryptic message:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"mount.nfs: Operation not permitted\\n\")), mdx(\"p\", null, \"As someone who has done this before on Debian-based LXC containers, I knew it was possible\\u2014but something was different this time. This post outlines what caused the problem, how I investigated it, and how I resolved it properly by leveraging host-side bind mounts.\"), mdx(\"hr\", null), mdx(\"h3\", null, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Problem: NFS Mount Fails Only Inside the Container\")), mdx(\"p\", null, \"I had two Ubuntu-based environments:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"A \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Proxmox VM\"), \": could mount NFS from Synology NAS without issues.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"A \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Proxmox LXC container\"), \" (unprivileged): \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"mount.nfs\"), \" failed with \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Operation not permitted\"), \".\")), mdx(\"p\", null, \"The NAS exports were configured correctly:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"showmount -e 192.168.0.25\\n/volume1/sharedfolder 192.168.0.200\\n\")), mdx(\"p\", null, \"The container\\u2019s IP was \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"192.168.0.200\"), \". NFS permissions on Synology were confirmed, root squash was disabled, yet the error persisted.\"), mdx(\"hr\", null), mdx(\"h3\", null, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Root Cause: Unprivileged LXC Containers Cannot Call \", mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"mount()\"), \" for NFS\")), mdx(\"p\", null, \"Unprivileged containers in Proxmox share the host kernel and are isolated using user namespaces. This means even \\\"root\\\" inside the container has no \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"CAP_SYS_ADMIN\"), \" in the host context. Mounting NFS requires kernel-level \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"mount()\"), \" system calls\\u2014which are blocked.\"), mdx(\"p\", null, \"This is a design choice for security and container isolation. While privileged containers can bypass this, they come with increased risks.\"), mdx(\"hr\", null), mdx(\"h3\", null, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Solution: Bind Mount Host NFS to LXC Container\")), mdx(\"p\", null, \"Instead of fighting container restrictions, I took the cleaner, more secure approach: \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"mount the NFS share on the Proxmox host\"), \", then \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"bind-mount it into the container\"), \".\"), mdx(\"h4\", null, mdx(\"strong\", {\n    parentName: \"h4\"\n  }, \"Step 1: Mount the NAS Share on Host\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"mkdir -p /mnt/nas\\nmount -t nfs 192.168.0.25:/volume1/sharedfolder /mnt/nas\\n\")), mdx(\"p\", null, \"Add to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/etc/fstab\"), \" for persistence:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"192.168.0.25:/volume1/sharedfolder  /mnt/nas  nfs  defaults  0  0\\n\")), mdx(\"h4\", null, mdx(\"strong\", {\n    parentName: \"h4\"\n  }, \"Step 2: Add a Bind Mount to the Container Config\")), mdx(\"p\", null, \"Edit container config:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"nano /etc/pve/lxc/117.conf\\n\")), mdx(\"p\", null, \"Add this line:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ini\"\n  }, \"mp0: /mnt/nas,mp=/nas2\\n\")), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"30%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuUlEQVQY043MzQqCQBiF4Q/NP5wL0LGwQXDvyosVFy1alKvqbmyQZqZcJBjhSLYLNImooGd7OC8IIS51XVVVnudFUXDOxW+U0n2PMSaEAMaPTXvbbHdxHEdRRAjxPG/am33AGLuuizEeVqDsdL52i+WKkLnv+5Zlmaap67phGJORoijqSNM0VVVhUJZlK5ssW4dhGASB4zgIIdu2EULD7avn+cDFvevSNAWAt+o/OOdSyiRJAOCV/M8DmPBjybdV0i8AAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"alt text\",\n    \"title\": \"alt text\",\n    \"src\": \"/static/fe3f2fccf9a4646a9c9d6fbb8b70eb67/7d769/image.png\",\n    \"srcSet\": [\"/static/fe3f2fccf9a4646a9c9d6fbb8b70eb67/5243c/image.png 240w\", \"/static/fe3f2fccf9a4646a9c9d6fbb8b70eb67/ab158/image.png 480w\", \"/static/fe3f2fccf9a4646a9c9d6fbb8b70eb67/7d769/image.png 960w\", \"/static/fe3f2fccf9a4646a9c9d6fbb8b70eb67/7416a/image.png 1320w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"p\", null, \"This maps \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/mnt/nas\"), \" on the host to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/nas2\"), \" inside the container.\"), mdx(\"p\", null, \"You can check the Container -> Resources, new Mount Point appeared:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"857px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"47.5%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzElEQVQoz53OwU7EIBSFYd7/5Vy6GBVtKIG2FG5BuBdaMJbEzTgm9tv/OYcBgANwzm2nnLP3HhFrrcepPsbmScVPH7x3zqVTPIUQiCilVEp5GD898xdpb2+DlGNK34OIKIRAxOM49n3v+/tv2O1daBte+ceyzD1ARO99SgkRY4z9CxHlO2zWKhMuy6yUmqapZ1JKpZQxZts25xwAEFG5w4ZhWNeViGqt/Uxr7edw+xMbxxEASint/xjn3BhzMRZCAEDO+UqstbbWXou/AN4cSFozeb7NAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"alt text\",\n    \"title\": \"alt text\",\n    \"src\": \"/static/645d4b2dd9900299c21772857488b2ff/d9174/image-1.png\",\n    \"srcSet\": [\"/static/645d4b2dd9900299c21772857488b2ff/5243c/image-1.png 240w\", \"/static/645d4b2dd9900299c21772857488b2ff/ab158/image-1.png 480w\", \"/static/645d4b2dd9900299c21772857488b2ff/d9174/image-1.png 857w\"],\n    \"sizes\": \"(max-width: 857px) 100vw, 857px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"h4\", null, mdx(\"strong\", {\n    parentName: \"h4\"\n  }, \"Step 3: Restart the Container\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"pct restart 117\\n\")), mdx(\"p\", null, \"Inside the container:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"ls /nas2\\n\")), mdx(\"p\", null, \"You should now see the mounted NAS contents.\"), mdx(\"hr\", null), mdx(\"h3\", null, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Bonus: Confirmed via Proxmox Web UI\")), mdx(\"p\", null, \"After editing the config, Proxmox UI under \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Resources\"), \" shows:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"Mount Point (mp0)  /mnt/nas,mp=/nas2\\n\")), mdx(\"p\", null, \"Clean and UI-friendly.\"), mdx(\"hr\", null), mdx(\"h3\", null, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Lessons Learned\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"NFS mounts inside unprivileged containers are blocked by design.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Don\\u2019t waste time trying to \\\"fix\\\" permissions\\u2014instead, leverage the host.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Proxmox makes bind-mounting very smooth with just a single line in the config.\")), mdx(\"hr\", null), mdx(\"h3\", null, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Conclusion\")), mdx(\"p\", null, \"This is a great example of understanding container limitations and working \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"with\"), \" them, not against them. While mounting directly inside a container feels natural, in the world of LXC, sometimes the cleanest path is to let the host do the heavy lifting.\"), mdx(\"p\", null, \"By bind-mounting your NAS share into the container, you get:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Full NFS access\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Security of unprivileged containers\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Simplicity of native Linux tooling\")), mdx(\"hr\", null));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Overview Recently while configuring a new Ubuntu 24.04 container inside Proxmox VE, I ran into a subtle but frustrating issue: NFS sharesâ€¦","timeToRead":2,"banner":null}},"pageContext":{"slug":"/mount-nfs-operation-not-permitted","formatString":"DD.MM.YYYY"}},
    "staticQueryHashes": ["2744905544","3090400250","318001574"]}